define("main",["require","exports","module"],function(e,t,o){"use strict";function r(e,t){function o(){e.releaseRef(),clearTimeout(m[i]),delete m[i],0===Object.keys(m).length&&l.triggerProjectSaved()}function r(){return e.isDirty?void c.execute({doc:e}).done(o).fail(function(e){console.error("[Autosave] failed write for `"+i+"`",e),o()}):void o()}var i=e.file.fullPath;(!m[i]||t)&&(e.addRef(),t?r():m[i]=setTimeout(r,n))}var n=5e3,i=!0,a=brackets.getModule("command/Commands").FILE_SAVE,c=brackets.getModule("command/CommandManager").get(a),d=brackets.getModule("document/DocumentManager"),u=brackets.getModule("editor/EditorManager"),l=brackets.getModule("bramble/BrambleEvents"),m={};d.on("dirtyFlagChange",function(e,t){t.isDirty&&(l.triggerProjectDirty(t.file.fullPath),r(t))}),u.on("activeEditorChange",function(e,t,o){o&&o.document.isDirty&&i&&r(o.document,!0)})});