define("Parameters3DUtils",["require","exports","module"],function(e,t,r){"use strict";function n(e){return o.hasOwnProperty(e)?o[e]:a}var i=/(-?((\d+(\.\d+)?)|(\.\d+))\s*)+/g,s="a-",a=25,o={position:50,scale:30,rotation:5,radius:50};t.PARAMETERS_3D_REGEX=i,t.TAG_START=s,t.getModifier=n}),define("text",["module"],function(e){"use strict";var t,r,n,i,s,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,u=d&&location.protocol&&location.protocol.replace(/\:/,""),h=d&&location.hostname,c=d&&(location.port||void 0),p={},m=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){r=a[t];try{e=new ActiveXObject(r)}catch(n){}if(e){a=[r];break}}return e},parseName:function(e){var t,r,n,i=!1,s=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!a||s>1)?(t=e.substring(0,s),r=e.substring(s+1,e.length)):t=e,n=r||t,s=n.indexOf("!"),-1!==s&&(i="strip"===n.substring(s+1),n=n.substring(0,s),r?r=n:t=n),{moduleName:t,ext:r,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,n,i){var s,a,o,l=t.xdRegExp.exec(e);return l?(s=l[2],a=l[3],a=a.split(":"),o=a[1],a=a[0],!(s&&s!==r||a&&a.toLowerCase()!==n.toLowerCase()||(o||a)&&o!==i)):!0},finishLoad:function(e,r,n,i){n=r?t.strip(n):n,m.isBuild&&(p[e]=n),i(n)},load:function(e,r,n,i){if(i.isBuild&&!i.inlineText)return void n();m.isBuild=i.isBuild;var s=t.parseName(e),a=s.moduleName+(s.ext?"."+s.ext:""),o=r.toUrl(a),l=m.useXhr||t.useXhr;return 0===o.indexOf("empty:")?void n():void(!d||l(o,u,h,c)?t.get(o,function(r){t.finishLoad(e,s.strip,r,n)},function(e){n.error&&n.error(e)}):r([a],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,n)}))},write:function(e,r,n,i){if(p.hasOwnProperty(r)){var s=t.jsEscape(p[r]);n.asModule(e+"!"+r,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,r,n,i,s){var a=t.parseName(r),o=a.ext?"."+a.ext:"",l=a.moduleName+o,d=n.toUrl(a.moduleName+o)+".js";t.load(l,n,function(r){var n=function(e){return i(d,e)};n.asModule=function(e,t){return i.asModule(e,d,t)},t.write(e,l,n,s)},s)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=require.nodeRequire("fs"),t.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");0===i.indexOf("\ufeff")&&(i=i.substring(1)),t(i)}catch(s){n(s)}}):"xhr"===m.env||!m.env&&t.createXhr()?t.get=function(e,r,n,i){var s,a=t.createXhr();if(a.open("GET",e,!0),i)for(s in i)i.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),i[s]);m.onXhr&&m.onXhr(a,e),a.onreadystatechange=function(t){var i,s;4===a.readyState&&(i=a.status,i>399&&600>i?(s=new Error(e+" HTTP status: "+i),s.xhr=a,n(s)):r(a.responseText),m.onXhrComplete&&m.onXhrComplete(a,e))},a.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var r,n,i="utf-8",s=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),l="";try{for(r=new java.lang.StringBuffer,n=o.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&r.append(n);null!==(n=o.readLine());)r.append(a),r.append(n);l=String(r.toString())}finally{o.close()}t(l)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var r,a,o,l={};s&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{r=n["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),r.init(o,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),a.init(r,"utf-8",r.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(r.available(),l),a.close(),r.close(),t(l.value)}catch(d){throw new Error((o&&o.path||"")+": "+d)}}),t}),define("text!Parameters.json",[],function(){return'{\n    "position":         { "labels": ["x", "y", "z"] },\n    "scale":            { "labels": ["x", "y", "z"] },\n    "rotation":         { "labels": ["x", "y", "z"] },\n    "radius":           { "labels": ["radius"] },\n    "width":            { "labels": ["width"] },\n    "height":           { "labels": ["height"] }\n}\n'}),define("text!ParameterEditorTemplate.html",[],function(){return'<div tabindex="-1" class="parameter-editor">\n    <div id="vec3">\n    </div>\n    <div class="sliders">\n        <div tabindex="0" class="selector-base">\n            <div class="selector"></div>\n        </div>\n    </div>\n</div>\n'}),define("ParameterEditor",["require","exports","module","Parameters3DUtils","text!Parameters.json","text!ParameterEditorTemplate.html"],function(e,t,r){"use strict";function n(e,t,r,n){this.$element=$(s.render(l,i)),e.append(this.$element),this._callback=t,this._tag=r,this._modifier=a.getModifier(this._tag)||10,this._handleSliderDrag=this._handleSliderDrag.bind(this),this.setSliderProperties(n),this.$selectionBase=this.$element.find(".selector-base"),this._addListeners()}var i=brackets.getModule("strings"),s=brackets.getModule("thirdparty/mustache/mustache"),a=e("Parameters3DUtils"),o=JSON.parse(e("text!Parameters.json")),l=e("text!ParameterEditorTemplate.html");n.prototype.getRootElement=function(){return this.$element},n.prototype._addListeners=function(){for(var e=function(r){this.$sliders[t].unbind("mousedown",this._mouseDownCallback),this.$sliders[t].unbind("mouseup",e)},t=0;t<this._numberOfParameters;t++)this.$sliders[t].bind("mousedown",{index:t,self:this},this._mouseDownCallback),this.$sliders[t].bind("mouseup",e),this._registerDragHandler(this.$sliders[t],this._handleSliderDrag,t);$(this.$element).on("mousedown",function(e){e.preventDefault()})},n.prototype._mouseDownCallback=function(e){var t=e.data.index,r=e.data.self;r._values[t]=parseFloat(e.currentTarget.value),r._position=e.clientX},n.prototype.focus=function(){return this.$selectionBase.is(":focus")?!1:(this.$selectionBase.focus(),!0)},n.prototype._commitParameters=function(e){this._callback(e)},n.prototype.setParametersFromString=function(e){this.setSliderProperties(e),this._commitParameters(e,!0)},n.prototype.isValidSetOfParameters=function(e){var t=new RegExp(a.PARAMETERS_3D_REGEX);return t.test(e)},n.prototype._setSpaces=function(e){this._spaces=[];for(var t=0;t<this._numberOfParameters-1;t++)e=e.substr(e.indexOf(" ")),this._spaces.push(e.search(/\S/)),e=e.substr(this._spaces[t])},n.prototype.setSliderProperties=function(e){this.$sliders=[],this._numberOfParameters=this._getNumberOfProperties(e),this._addSliders(),this._setLabels(),this._values=[];for(var t=0;t<this._numberOfParameters;t++)this._values.push(parseFloat(this.$sliders[t].val()));var r=e.trim().match(/\S+/g);this._setSpaces(e);for(var t=0;t<this._numberOfParameters;t++)this.$sliders[t].val(r[t])},n.prototype._addSliders=function(){for(var e=0;e<this._numberOfParameters;e++){var t=$("<span />").attr("id","label-"+(e+1)),r=$("<input />").attr("id","input-"+(e+1)).attr("class","input-box").attr("type","text");this.$element.find("#vec3").append(t),this.$element.find("#vec3").append(r),this.$sliders.push(this.$element.find("#input-"+(e+1)))}},n.prototype._setLabels=function(){var e=o[this._tag];if(e){var t=e.labels;if(t)for(var r=0;r<t.length;r++)this.$element.find("#label-"+(r+1)).html(t[r]+" &rarr;")}},n.prototype._getNumberOfProperties=function(e){var t=e.trim().match(/\S+/g);return t.length},n.prototype._getOffset=function(e,t){var r=e-t;return r/this._modifier},n.prototype._handleSliderDrag=function(e){var t=e.data.index,r=this._position,n=this._getOffset(e.clientX,r),i=this._values[t]+n;this.$sliders[t].val(i.toFixed(2)),this._commitParameters(this._getParameters())},n.prototype._getWhiteSpaces=function(e){for(var t="",r=0;e>r;r++)t+=" ";return t},n.prototype._getParameters=function(){for(var e="",t=0;t<this._numberOfParameters-1;t++)e+=this.$sliders[t].val(),e+=this._getWhiteSpaces(this._spaces[t]);return e+=this.$sliders[t].val()},n.prototype._registerDragHandler=function(e,t,r){var n=function(e){$(window).unbind("mousemove",t),$(window).unbind("mouseup",n)};e.mousedown(function(e){$(window).bind("mousemove",{index:r},t),$(window).bind("mouseup",n)}),e.mousedown({index:r},t)},t.ParameterEditor=n}),define("Inline3DParameterEditor",["require","exports","module","ParameterEditor","Parameters3DUtils"],function(e,t,r){"use strict";function n(e,t,r){this._handleParametersChange=this._handleParametersChange.bind(this),this._handleHostDocumentChange=this._handleHostDocumentChange.bind(this),this._parameters=e,this._marker=t,this._tag=r,this._isOwnChange=!1,this._isHostChange=!1,this._origin="+InlineParameterditor_"+o++,i.call(this)}var i=brackets.getModule("editor/InlineWidget").InlineWidget,s=e("ParameterEditor").ParameterEditor,a=e("Parameters3DUtils"),o=1;n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n.prototype.parentClass=i.prototype,n.prototype.ParameterEditor=null,n.prototype._parameters=null,n.prototype._marker=null,n.prototype._isOwnChange=null,n.prototype._isHostChange=null,n.prototype._origin=null,n.prototype.getCurrentRange=function(){var e,t,r;if(e=this._marker&&this._marker.find(),t=e&&e.from,!t)return null;r=e.to,r||(r={line:t.line});var n=this.hostEditor.document.getLine(t.line),i=n.substr(t.ch).match(a.PARAMETERS_3D_REGEX);return i&&(void 0===r.ch||r.ch-t.ch<i[0].length)&&(i[0]=i[0].trim(),r.ch=t.ch+i[0].length,this._marker.clear(),this._marker=this.hostEditor._codeMirror.markText(t,r)),void 0===r.ch?null:{start:t,end:r}},n.prototype._handleParametersChange=function(e){var t=this;if(e!==this._parameters){var r=this.getCurrentRange();if(!r)return;if(!this._isHostChange){var n={line:r.start.line,ch:r.start.ch+e.length};this._isOwnChange=!0,this.hostEditor.document.batchOperation(function(){t.hostEditor.setSelection(r.start,r.end),t.hostEditor.document.replaceRange(e,r.start,r.end,t._origin),t.hostEditor.setSelection(r.start,n),t._marker&&(t._marker.clear(),t._marker=t.hostEditor._codeMirror.markText(r.start,n))}),this._isOwnChange=!1}this._parameters=e}},n.prototype.load=function(e){n.prototype.parentClass.load.apply(this,arguments),this.parameterEditor=new s(this.$htmlContent,this._handleParametersChange,this._tag,this._parameters)},n.prototype.onAdded=function(){n.prototype.parentClass.onAdded.apply(this,arguments);var e=this.hostEditor.document;e.addRef(),e.on("change",this._handleHostDocumentChange),this.hostEditor.setInlineWidgetHeight(this,this.parameterEditor.getRootElement().outerHeight(),!0),this.parameterEditor.focus()},n.prototype.onClosed=function(){n.prototype.parentClass.onClosed.apply(this,arguments),this._marker&&this._marker.clear();var e=this.hostEditor.document;e.off("change",this._handleHostDocumentChange),e.releaseRef()},n.prototype._handleHostDocumentChange=function(){if(!this._isOwnChange){var e=this.getCurrentRange();if(e){var t=this.hostEditor.document.getRange(e.start,e.end);t!==this._parameters&&this.parameterEditor.isValidSetOfParameters(t)&&(this._isHostChange=!0,this.parameterEditor.setParametersFromString(t),this._isHostChange=!1)}else this.close()}},t.Inline3DParameterEditor=n}),define("main",["require","exports","module","Parameters3DUtils","Inline3DParameterEditor"],function(e,t,r){"use strict";function n(e){var t=h.TAG_START;return e.substr(0,2)===t}function i(e,t,r){var n,i,s,a,o,l,d;for(s=h.PARAMETERS_3D_REGEX,s.lastIndex=0,i=e.document.getLine(t.line),n=s.exec(i);n&&(a=n.index,o=a+n[0].trim().length,!(t.ch>=a&&t.ch<=o));)n=s.exec(i);return n?(t.ch=a,l={line:t.line,ch:o},d=e._codeMirror.markText(t,l),e.setSelection(t,l),{parameters:n[0],marker:d,tag:r.attr.name}):null}function s(e,t){var r,s;if(r=e.getSelection(),r.start.line!==r.end.line)return null;var s=u.getTagInfo(e,r.start);return n(s.tagName)?i(e,t,s):null}function a(e,t){var r,n,i=s(e,t);return i?(r=new c(i.parameters,i.marker,i.tag),r.load(e),n=new $.Deferred,n.resolve(r).promise()):null}function o(e,t){var r,i,s,a,o,l,d;if(i=e.getSelection(),i.start.line!==i.end.line)return!1;var s=u.getTagInfo(e,i.start);if(!n(s.tagName))return!1;for(o=h.PARAMETERS_3D_REGEX,o.lastIndex=0,a=e.document.getLine(t.line),r=o.exec(a);r&&(l=r.index,d=l+r[0].trim().length,!(t.ch>=l&&t.ch<=d));)r=o.exec(a);return!!r}var l=brackets.getModule("editor/EditorManager"),d=brackets.getModule("utils/ExtensionUtils"),u=brackets.getModule("language/HTMLUtils"),h=e("Parameters3DUtils"),c=e("Inline3DParameterEditor").Inline3DParameterEditor;d.loadStyleSheet(r,"css/main.less"),l.registerInlineEditProvider(a,o),t.prepareParametersForProvider=s});